# 📖 GUIDE D'UTILISATION COMPLET - PLANIFICATEUR DE TERRAIN

Version : 2.0 RÉVOLUTIONNAIRE  
Date : 18 octobre 2025

---

## 🚀 DÉMARRAGE RAPIDE

### **Étape 1 : Sélectionner vos arbres**
1. Cliquez sur **Comparer** (bouton vert en haut à droite)
2. Sélectionnez 2-3 arbres dans la liste
3. Comparez leurs caractéristiques

### **Étape 2 : Ouvrir le planificateur**
1. Cliquez sur **Planifier** (bouton bleu)
2. Au premier lancement : **Onboarding interactif** (5 étapes)
3. Suivez le guide ou cliquez "Passer"

### **Étape 3 : Créer votre plan**
Le planificateur s'ouvre avec :
- **Plan par défaut** : Clôture, maison, pavés
- **Arbres sélectionnés** : Placés automatiquement
- **Interface organisée** : Dashboard (gauche), Outils (droite), Timeline (bas)

---

## 🎨 INTERFACE DÉTAILLÉE

### **📊 Dashboard (Gauche)**
Position : Fixe à gauche (20px)

**Affichage en temps réel :**
- 🌳 **Arbres** : Nombre total (à planter + existants)
- 📏 **Surfaces** : 
  - Totale : m² disponibles
  - Plantée : Somme des couronnes arbres
  - Minérale : Terrasses + pavés
  - Libre : Ce qui reste
- 📊 **Barre graphique** : Répartition visuelle (vert/gris/blanc)
- 🦋 **Biodiversité** : 
  - Score 0-100
  - ⭐⭐⭐⭐⭐ (5 étoiles max)
  - Mellifères, fruitiers comptabilisés
- 💧 **Arrosage** : Litres/semaine estimés
- ⏱️ **Entretien** : Heures/mois (30min/arbre)
- ⚖️ **Conformité** : % réglementaire
  - 🟢 100% : Parfait
  - 🟡 80-99% : Avertissements
  - 🔴 <80% : Problèmes
- 🌍 **Composition du sol** :
  - Visualisation 2 couches
  - Profondeurs (cm)
  - Types (fertile, argileux, etc.)
  - **Bouton ✏️ Modifier**

**Mise à jour :** Automatique toutes les 2 secondes

---

### **🛠️ Palette d'Outils (Droite)**
Position : Fixe à droite (20px)  
Déplaçable : Glisser sur la barre du haut

**🏗️ Structures :**
- 🏠 **Maison** (10m × 10m, H: 7m)
  - Clic pour placer
  - Double-clic pour éditer hauteur
  - Fondations éditables
- 🏡 **Terrasse** (4m × 3m)
  - Redimensionnable
- 🟩 **Pavés enherbés** (5m × 5m)
  - Zones perméables

**🔧 Réseaux :**
- 🚰 **Canalisation** (prof. 0.6m)
  - Ligne grise continue
  - Double-clic pour courber
  - Profondeur éditable
- 💧 **Citerne/Fosse** (2m × 3m, prof. 2.5m)
  - Validation 3D automatique
- 🚧 **Clôture** (limite propriété)
  - Ligne jaune pointillée
  - = Limite légale voisinage
  - Double-clic pour courber

**🌳 Végétation :**
- 🌳 **Arbre existant** (rayon 2.5m)
  - Vert, à conserver

**👁️ Affichage :**
- 👁️ **Zones contraintes** (ON/OFF)
  - Halos colorés distances légales
  - 🔴 Rouge : Interdit
  - 🟠 Orange : Attention
  - 🟡 Jaune : Limite
- ☀️ **Ombre maison** (ON/OFF)
  - Selon saison et hauteur
  - Active sélecteur saisons

**⚡ Actions :**
- 🔒 **Verrouiller** : Empêche déplacement
- 🗑️ **Supprimer** : Efface sélection (ou touche Suppr)
- ⚠️ **Tout effacer** : Réinitialise plan complet

**📷 Image de fond :**
- Charger plan Kazaplan, cadastre, photo
- Régler opacité (0-100%)
- Superposition au-dessus grille

---

### **📅 Timeline de Croissance (Bas)**
Position : Fixe en bas, centrée

**Slider temporel :**
- **0 ans** : Plantation (H: 2m, Ø: 0.8m, Tronc: ⌀5cm)
- **1-19 ans** : Croissance progressive
- **20+ ans** : Maturité (taille adulte max)

**Affichage :**
- 🌱 Plantation - Jeune plant
- 🌿 X ans - Croissance en cours (~X% maturité)
- 🌳 Maturité atteinte

**Effet en temps réel :**
- Ellipses arbres s'agrandissent
- Labels mis à jour
- Cercle tronc adapté
- Zones contraintes recalculées

**Sélecteur saisons** (si ombre activée) :
- ❄️ **Hiver** : Soleil bas 18° → Ombre 21m
- 🌸 **Printemps** : Équinoxe 45° → Ombre 7m
- ☀️ **Été** : Soleil haut 65° → Ombre 3m
- 🍂 **Automne** : Équinoxe 45° → Ombre 7m

---

## 🎯 UTILISATION AVANCÉE

### **Créer un plan de A à Z**

**1. Définir le terrain :**
- Ajouter **🚧 Clôtures** pour délimiter
- Double-cliquer sur ligne pour créer angles
- Connecter les lignes

**2. Placer les structures :**
- 🏠 **Maison** : Position + taille exacte
- 🏡 **Terrasse** : Où vous voulez
- 🟩 **Pavés** : Zones parking/stationnement

**3. Réseaux enterrés :**
- 🚰 **Canalisations** : Tracer depuis maison
- 💧 **Citerne/Fosse** : Position éloignée

**4. Végétation existante :**
- 🌳 **Arbres existants** : Ceux à garder

**5. Placer nouveaux arbres :**
- Déjà placés automatiquement !
- **Déplacer** : Glisser-déposer
- **Validation live** : Couleur + lignes rouges

**6. Optimiser avec outils :**
- Activer **👁️ Zones** : Voir interdictions
- Activer **☀️ Ombre** : Tester saisons
- **Timeline** : Tester dans 10 ans

---

### **Validation en temps réel**

**Pendant le déplacement d'un arbre :**

**Visuel sur canvas :**
- ⭕ **Cercle tronc** (rouge) : Diamètre selon âge
- 🔴 **Lignes rouges** : Vers obstacles trop proches
- 📏 **Labels** : "🏠 3.2m < 5m requis"

**Panneau latéral (droite) :**
- 🔴 **Rouge** : Problèmes critiques (ILLÉGAL)
- 🟠 **Orange** : Avertissements
- 🟢 **Vert** : Conforme ✅

**Messages légaux :**
```
⚖️ ILLÉGAL: Tronc dépasse limite propriété
   → Voisin peut exiger arrachage

⚖️ DISTANCE LÉGALE NON RESPECTÉE: 1.5m < 2m
   (Code Civil Art. 671)
   → Voisin peut exiger arrachage ou taille à 2m
```

---

### **Modifier les objets**

**Dimensions (rectangles) :**
- Cliquer sur **"10m"** (largeur) → Saisir nouvelle valeur
- Cliquer sur **"7m"** (hauteur) → Idem
- **Décimales acceptées** : 10.5m, 7.3m

**Diamètre (cercles) :**
- Cliquer sur **"⌀ 5m"** → Saisir
- Tronc + couronne adaptés

**Profondeur fondations (maison) :**
- Double-clic sur maison
- Saisir hauteur bâtiment (7m par défaut)

**Composition du sol :**
- Dashboard → Section 🌍 Sol
- Cliquer **✏️ Modifier**
- Saisir nom, profondeur (cm), type

---

### **Raccourcis clavier**

- **Suppr** : Supprimer sélection
- **Ctrl+D** : Dupliquer
- **↑ ↓ ← →** : Déplacer 10cm
- **Shift + ↑** : Déplacer 1m
- **Double-clic ligne** : Ajouter point intermédiaire
- **Clic mesure** : Éditer valeur

---

## 🔍 DEBUG & LOGS

### **Bouton 🐛 (orange)**
Ouvre le visualiseur de logs

**Actions disponibles :**
- 🔄 **Rafraîchir** : Recharge les logs
- 📊 **Statistiques** : Affiche stats console
- 💾 **Exporter** : Télécharge JSON
- 🗑️ **Effacer** : Vide historique
- **Filtres** : Par niveau (error/warn/info/debug) ou composant

**Console globale :**
```javascript
// F12 → Console
window.planificateurLogs.getHistory()  // Tous les logs
window.planificateurLogs.stats()       // Statistiques
window.planificateurLogs.export()      // Exporter JSON
window.planificateurLogs.clear()       // Effacer
```

---

## 💡 ASTUCES & BONNES PRATIQUES

### **1. Commencer par les clôtures**
- Délimitez votre terrain en premier
- Double-cliquez pour créer des angles
- Cela définit la limite légale

### **2. Placer la maison en premier**
- Éditer sa hauteur (7m par défaut)
- Activer l'ombre pour voir impact
- Tester les 4 saisons

### **3. Utiliser la timeline**
- Glisser à **0 ans** : Voir taille plantation
- Glisser à **10 ans** : Anticiper croissance
- Glisser à **20+ ans** : Vérifier maturité

### **4. Optimiser avec zones**
- Activer **👁️** pour voir zones interdites
- Éviter zones rouges/oranges
- Rester dans zones vertes

### **5. Tester l'ombre**
- Activer **☀️**
- Tester **❄️ Hiver** : Ombre longue
- Placer arbres héliophiles au sud
- Placer arbres d'ombre au nord

### **6. Surveiller le dashboard**
- Score biodiversité : Viser ⭐⭐⭐⭐⭐
- Conformité : Maintenir 100%
- Arrosage : Minimiser (économie eau)

---

## ⚠️ ERREURS COURANTES

### **Arbres non visibles ?**
1. Ouvrir **🐛 Logs**
2. Filtrer par **CanvasTerrain**
3. Chercher :
   - "Arbres non ajoutés"
   - "Tentative ajout de X arbres"
   - "✅ X arbres ajoutés"

### **Validation rouge permanente ?**
- Lire le **panneau latéral** (droite)
- Respecter distances indiquées
- Référence : `reglementation.distancesLegales` dans données arbre

### **Plan ne se sauvegarde pas ?**
- Sauvegarde automatique dans localStorage
- Vérifie localStorage actif (pas en navigation privée)
- Logs : Chercher "Plan sauvegardé"

---

## 📊 CALCULS & FORMULES

### **Tailles arbres selon âge :**
```
hauteur_actuelle = 2m + (hauteur_max - 2m) × (annee / annees_maturite)
envergure_actuelle = 0.8m + (envergure_max - 0.8m) × (annee / annees_maturite)
tronc_actuel = 5cm + (tronc_max - 5cm) × (annee / annees_maturite)
```

### **Ombre portée :**
```
longueur_ombre = hauteur_maison / tan(angle_soleil)
direction = vers le nord (opposé ☀️ SUD)
```

### **Score biodiversité :**
```
Score = 0
+ 30 si mellifère (abeilles)
+ 25 si fructification (oiseaux)
+ 20 si ≥3 espèces différentes
+ 15 si plantes locales
= Max 100
```

---

## 🎓 CONCEPTS CLÉS

### **Validation 3D**
Compare profondeurs verticales :
- Racines arbre : 1-1.5m
- Fondations maison : 1.2m
- Canalisations : 0.6m
- Citerne : 2.5m

**Exemple critique :**
```
Racines 1.5m > Fondations 0.8m
→ 🔴 CRITIQUE: Risque fissures
```

### **Code Civil Art. 671**
Distance légale voisinage :
- Hauteur > 2m : Distance ≥ 2m de la limite
- Sanction : Voisin peut exiger arrachage
- Clôtures = Limite de propriété

### **Timeline réaliste**
Croissance linéaire basée sur :
- Vitesse croissance extraite (ex: "30-40 cm/an")
- Années maturité calculées
- Interpolation plantation → adulte

---

## 📱 RACCOURCIS & ASTUCES

### **Édition rapide :**
- **Clic mesure** : Changer taille
- **Double-clic maison** : Hauteur bâtiment
- **Double-clic ligne** : Courber (point intermédiaire)

### **Navigation :**
- **Scroll** : Zoom canvas (si activé)
- **Glisser espace vide** : Pan (si activé)

### **Sélection :**
- **Clic** : Sélectionner objet
- **Menu contextuel** : Verrouiller/Supprimer
- **Shift+Clic** : Multi-sélection (si activé)

---

## 🆘 SUPPORT

### **Problème technique ?**
1. Bouton **🐛** → Logs
2. Exporter JSON
3. Partager logs pour diagnostic

### **Question fonctionnalité ?**
1. Bouton **❓** → Onboarding
2. Revoir les 5 étapes guidées

### **Suggestions ?**
- Le planificateur est open-source
- Architecture modulaire
- Contributions bienvenues

---

**Bon jardinage ! 🌳🏡✨**

